<?php
/**
 * Created by PhpStorm.
 * User: Jenner
 * Date: 15-1-22
 * Time: 下午1:09
 */

$records = [
    ['bill_time'=>'2014-01-01 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-01 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-01 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-01 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-01 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-01 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-02 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-02 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-02 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-02 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-02 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-03 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-03 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-03 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-03 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-03 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-04 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-04 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-04 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-04 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-04 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-05 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-05 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-05 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-05 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-05 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-06 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-06 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-06 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-06 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-06 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-07 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-07 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-07 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-07 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-07 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-07 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-08 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-08 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-08 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-08 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-08 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-09 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-09 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-09 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-09 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-09 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-10 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-10 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-10 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-10 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-10 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-11 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-11 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-11 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-11 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-11 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-12 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-12 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-12 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-12 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-12 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-13 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-13 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-13 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-13 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-13 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-13 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-14 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-14 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-14 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-14 00:00:00', 'price'=>1, 'cnt'=>3,],
    ['bill_time'=>'2014-01-14 00:00:00', 'price'=>1, 'cnt'=>3,],
];


$group_by_fields = [
    'bill_time' => function($field){
            return substr($field, 0, 10);
        }
];

$group_by_values = [
    'bill_time' => function($field_values){
            return substr($field_values[0], 0, 10);
        },
    'price' => function($field_values){
            return array_sum($field_values);
        },
    'cnt' => function($field_values){
            return array_sum($field_values);
        }
];


$week_fields = [
    'bill_time' => function($field){
            return date('w', strtotime($field));
        }
];

$week_values = [
    'bill_time' => function($field_values){
            return date('w', strtotime($field_values[0]));
        },
    'price' => function($field_values){
            return array_sum($field_values);
        },
    'cnt' => function($field_values){
            return array_sum($field_values);
        }
];

$grouped = (new \Jenner\Zebra\ArrayGroupBy($records))->groupByField($group_by_fields)->groupByValue($group_by_values)->groupByField($week_fields)->groupByValue($week_values)->get();


print_r($grouped);